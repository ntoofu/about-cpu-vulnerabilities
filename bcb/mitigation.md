# 緩和策

* 緩和策についても, やや事情が複雑な上, 状況がしきりに変わっている

## 影響箇所について

* 特定の処理パターンに問題があるため, そうしたパターンに対して対策を施す必要があり, そうした処理パターンが存在するソフトウェア全てで対策を施さなければならない
  * 何らかの形で第三者コードの実行をするようなものが主に当てはまる
* したがって, OSやハイパーバイザーやブラウザ等はそれぞれ個別に対策を行っている

## 対策方法について

* Intelは`LFENCE`命令という, 投機的実行を抑制するような命令をソフトウェア側で行うことを対策として述べている
  * パフォーマンスへの影響が大きいようで, パフォーマンスがクリティカルな場所では歓迎されてはいない様子
* 境界値チェックをパスした後の処理で, インデックスを直接使わずに本当に範囲内かどうかを確かめるビット演算を挟んで処理させる仕組みを入れる
  * [Linuxなどで行われている](https://lwn.net/Articles/744287/) もので, `array_index_nospec` というマクロとして入っているらしい

## まとめ
* 問題の起こりうるソフトウェア全てで対策したものを使わないといけない
  * 残念ながら, ファームウェアを上げればOKとか, OSのバージョンを上げればOKというものではない
  * とはいえ基本的には, 何らかの形で第三者コードを実行する環境が気にすることなので, OSやブラウザが主に該当する
