# 分岐予測

* 分岐により次に実行すべき命令が確定しないときの投機的実行では, **分岐予測**に基づき実行する命令を選択する仕組みが一般的
  * 実行する可能性のある命令全てを並行して実行するような方法も考えられるが, 計算資源を非常に多く消費してしまうため, 予測に基づいて1つのフローを実行していくのが普通
  * 分岐は必ず成立する/しないとすることも可能だが, 半分程度の確度の予測では性能向上も知れている
* 繰り返される条件分岐では, 過去と同じ結果になることが多いため, **過去の分岐の結果(分岐履歴)に基づく予測をする**ことが多い
  * 昔は単に, ある分岐について, それが成立/不成立する度にカウンタをインクリメント/デクリメントして, それに応じて予測も決めていた
  * 分岐予測の精度は性能向上に重要で, 進化しつづけている
    * 例えばAMD Ryzenはニューラルネットワーク(パーセプトロン)を用いた予測をしていると言っていたりする
* CPU脆弱性の観点では, 事前に分岐の成立/不成立が一定のパターンで行われるように意図的に仕向けることで, **次回の予測がどちらになされるかをある程度コントロールできてしまう**
